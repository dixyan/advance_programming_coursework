<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Admin User | Movie Booking System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-styles.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Admin Movie</h2>
                <button class="close-sidebar" id="closeSidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="admin-dashboard.html">
                            <i class="fas fa-film"></i>
                            <span>Movies</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-theaters.html">
                            <i class="fas fa-building"></i>
                            <span>Theaters</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="admin-users-management.html">
                            <i class="fas fa-user-shield"></i>
                            <span>Admin Users</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-customers.html">
                            <i class="fas fa-users"></i>
                            <span>Customers</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-orders.html">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Orders</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-reports.html">
                            <i class="fas fa-chart-bar"></i>
                            <span>Report</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <div class="admin-info">
                    <div class="admin-avatar">A</div>
                    <span>administrator</span>
                </div>
                <a href="admin-login.html" class="logout-link">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <header class="main-header">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="header-right">
                    <div class="admin-info">
                        <div class="admin-avatar">A</div>
                        <span>administrator</span>
                    </div>
                </div>
            </header>

            <main class="content">
                <div class="content-header">
                    <h1>Add New Admin User</h1>
                    <a href="admin-users-management.html" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i> Back to Admin Users
                    </a>
                </div>

                <div class="card">
                    <div class="card-body">
                        <form id="addAdminForm" class="admin-form">
                            <div class="form-section">
                                <h3>Account Information</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adminName">Full Name <span class="required">*</span></label>
                                        <input type="text" id="adminName" placeholder="Enter full name" required>
                                        <div class="error-message" id="nameError"></div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="adminEmail">Email Address <span class="required">*</span></label>
                                        <input type="email" id="adminEmail" placeholder="Enter email address" required>
                                        <div class="error-message" id="emailError"></div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adminUsername">Username <span class="required">*</span></label>
                                        <input type="text" id="adminUsername" placeholder="Enter username" required>
                                        <div class="error-message" id="usernameError"></div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="adminPhone">Phone Number</label>
                                        <input type="tel" id="adminPhone" placeholder="Enter phone number">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>Security</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adminPassword">Password <span class="required">*</span></label>
                                        <div class="password-input">
                                            <input type="password" id="adminPassword" placeholder="Create a password" required>
                                            <button type="button" class="toggle-password" id="togglePassword">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="error-message" id="passwordError"></div>
                                        <div class="password-strength" id="passwordStrength">
                                            <div class="strength-meter">
                                                <div class="strength-bar" id="strengthBar"></div>
                                            </div>
                                            <div class="strength-text" id="strengthText">Password strength</div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="adminConfirmPassword">Confirm Password <span class="required">*</span></label>
                                        <div class="password-input">
                                            <input type="password" id="adminConfirmPassword" placeholder="Confirm password" required>
                                            <button type="button" class="toggle-password" id="toggleConfirmPassword">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                        <div class="error-message" id="confirmPasswordError"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>Role & Permissions</h3>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="adminRole">Role <span class="required">*</span></label>
                                        <select id="adminRole" required>
                                            <option value="">Select a role</option>
                                            <option value="admin">Admin</option>
                                            <option value="super-admin">Super Admin</option>
                                            <option value="content-manager">Content Manager</option>
                                            <option value="support">Support Staff</option>
                                        </select>
                                        <div class="error-message" id="roleError"></div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="adminStatus">Status</label>
                                        <select id="adminStatus">
                                            <option value="Active">Active</option>
                                            <option value="Inactive">Inactive</option>
                                            <option value="Pending">Pending Activation</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Permissions</label>
                                    <div class="permissions-grid">
                                        <div class="permission-item">
                                            <input type="checkbox" id="permMovies" checked>
                                            <label for="permMovies">Manage Movies</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permTheaters" checked>
                                            <label for="permTheaters">Manage Theaters</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permUsers">
                                            <label for="permUsers">Manage Users</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permOrders" checked>
                                            <label for="permOrders">Manage Orders</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permReports">
                                            <label for="permReports">View Reports</label>
                                        </div>
                                        <div class="permission-item">
                                            <input type="checkbox" id="permSettings">
                                            <label for="permSettings">System Settings</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h3>Additional Information</h3>
                                
                                <div class="form-group">
                                    <label for="adminNotes">Notes</label>
                                    <textarea id="adminNotes" rows="3" placeholder="Add any additional notes about this admin user"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="sendWelcomeEmail" checked>
                                        <label for="sendWelcomeEmail">Send welcome email with login details</label>
                                    </div>
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="requirePasswordChange" checked>
                                        <label for="requirePasswordChange">Require password change on first login</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="cancelBtn">Cancel</button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-user-plus"></i> Create Admin User
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Success</h2>
                <button class="close-modal" id="closeSuccessModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="success-message">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Admin User Created Successfully!</h3>
                    <p>The new admin user has been added to the system.</p>
                    <div class="modal-actions">
                        <button class="btn btn-outline" id="addAnotherBtn">Add Another Admin</button>
                        <button class="btn btn-primary" id="viewAdminsBtn">View All Admins</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the admin interface
            initAdminInterface();
            
            // Password visibility toggle
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('adminPassword');
            
            togglePassword.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                const icon = this.querySelector('i');
                if (type === 'password') {
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                } else {
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                }
            });
            
            // Confirm password visibility toggle
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const confirmPasswordInput = document.getElementById('adminConfirmPassword');
            
            toggleConfirmPassword.addEventListener('click', function() {
                const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                confirmPasswordInput.setAttribute('type', type);
                
                const icon = this.querySelector('i');
                if (type === 'password') {
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                } else {
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                }
            });
            
            // Password strength meter
            const strengthBar = document.getElementById('strengthBar');
            const strengthText = document.getElementById('strengthText');
            
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                const strength = calculatePasswordStrength(password);
                
                // Update strength bar
                strengthBar.style.width = strength.percent + '%';
                strengthBar.className = 'strength-bar ' + strength.level;
                
                // Update strength text
                strengthText.textContent = strength.message;
            });
            
            // Role selection affects permissions
            const roleSelect = document.getElementById('adminRole');
            
            roleSelect.addEventListener('change', function() {
                const role = this.value;
                
                // Reset all checkboxes
                document.querySelectorAll('.permission-item input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Set permissions based on role
                if (role === 'super-admin') {
                    document.querySelectorAll('.permission-item input[type="checkbox"]').forEach(checkbox => {
                        checkbox.checked = true;
                    });
                } else if (role === 'admin') {
                    document.getElementById('permMovies').checked = true;
                    document.getElementById('permTheaters').checked = true;
                    document.getElementById('permOrders').checked = true;
                    document.getElementById('permReports').checked = true;
                } else if (role === 'content-manager') {
                    document.getElementById('permMovies').checked = true;
                    document.getElementById('permTheaters').checked = true;
                } else if (role === 'support') {
                    document.getElementById('permOrders').checked = true;
                }
            });
            
            // Form validation and submission
            const addAdminForm = document.getElementById('addAdminForm');
            
            addAdminForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Reset error messages
                document.querySelectorAll('.error-message').forEach(el => {
                    el.textContent = '';
                });
                
                let isValid = true;
                
                // Validate name
                const name = document.getElementById('adminName').value;
                if (!name) {
                    document.getElementById('nameError').textContent = 'Name is required';
                    isValid = false;
                }
                
                // Validate email
                const email = document.getElementById('adminEmail').value;
                if (!email) {
                    document.getElementById('emailError').textContent = 'Email is required';
                    isValid = false;
                } else if (!isValidEmail(email)) {
                    document.getElementById('emailError').textContent = 'Please enter a valid email address';
                    isValid = false;
                }
                
                // Validate username
                const username = document.getElementById('adminUsername').value;
                if (!username) {
                    document.getElementById('usernameError').textContent = 'Username is required';
                    isValid = false;
                } else if (username.length < 4) {
                    document.getElementById('usernameError').textContent = 'Username must be at least 4 characters';
                    isValid = false;
                }
                
                // Validate password
                const password = document.getElementById('adminPassword').value;
                if (!password) {
                    document.getElementById('passwordError').textContent = 'Password is required';
                    isValid = false;
                } else if (password.length < 8) {
                    document.getElementById('passwordError').textContent = 'Password must be at least 8 characters';
                    isValid = false;
                }
                
                // Validate confirm password
                const confirmPassword = document.getElementById('adminConfirmPassword').value;
                if (password !== confirmPassword) {
                    document.getElementById('confirmPasswordError').textContent = 'Passwords do not match';
                    isValid = false;
                }
                
                // Validate role
                const role = document.getElementById('adminRole').value;
                if (!role) {
                    document.getElementById('roleError').textContent = 'Please select a role';
                    isValid = false;
                }
                
                if (isValid) {
                    // Get selected permissions
                    const permissions = [];
                    document.querySelectorAll('.permission-item input[type="checkbox"]:checked').forEach(checkbox => {
                        permissions.push(checkbox.id.replace('perm', ''));
                    });
                    
                    // Create admin object
                    const adminData = {
                        id: Date.now(),
                        name: name,
                        email: email,
                        username: username,
                        phone: document.getElementById('adminPhone').value,
                        password: password, // In a real app, this would be hashed
                        role: role,
                        status: document.getElementById('adminStatus').value,
                        permissions: permissions,
                        notes: document.getElementById('adminNotes').value,
                        sendWelcomeEmail: document.getElementById('sendWelcomeEmail').checked,
                        requirePasswordChange: document.getElementById('requirePasswordChange').checked,
                        createdAt: new Date().toISOString()
                    };
                    
                    // Save admin to localStorage
                    addAdminUser(adminData);
                    
                    // Show success modal
                    document.getElementById('successModal').classList.add('show');
                }
            });
            
            // Cancel button
            document.getElementById('cancelBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to cancel? Any unsaved changes will be lost.')) {
                    window.location.href = 'admin-users-management.html';
                }
            });
            
            // Success modal actions
            document.getElementById('closeSuccessModal').addEventListener('click', function() {
                document.getElementById('successModal').classList.remove('show');
            });
            
            document.getElementById('addAnotherBtn').addEventListener('click', function() {
                document.getElementById('successModal').classList.remove('show');
                addAdminForm.reset();
            });
            
            document.getElementById('viewAdminsBtn').addEventListener('click', function() {
                window.location.href = 'admin-users-management.html';
            });
        });
        
        // Helper function to validate email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Helper function to calculate password strength
        function calculatePasswordStrength(password) {
            if (!password) {
                return { level: 'empty', percent: 0, message: 'Password strength' };
            }
            
            let strength = 0;
            
            // Length check
            if (password.length >= 8) strength += 25;
            
            // Contains lowercase letters
            if (/[a-z]/.test(password)) strength += 25;
            
            // Contains uppercase letters
            if (/[A-Z]/.test(password)) strength += 25;
            
            // Contains numbers or special characters
            if (/[0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) strength += 25;
            
            // Determine level and message
            let level, message;
            
            if (strength <= 25) {
                level = 'weak';
                message = 'Weak';
            } else if (strength <= 50) {
                level = 'medium';
                message = 'Medium';
            } else if (strength <= 75) {
                level = 'good';
                message = 'Good';
            } else {
                level = 'strong';
                message = 'Strong';
            }
            
            return { level, percent: strength, message };
        }
        
        // Add admin user to localStorage
        function addAdminUser(adminData) {
            const admins = getAdminUsers();
            admins.push(adminData);
            localStorage.setItem('adminUsers', JSON.stringify(admins));
        }
        
        // Get admin users from localStorage
        function getAdminUsers() {
            return JSON.parse(localStorage.getItem('adminUsers') || '[]');
        }
    </script>
</body>
</html>
